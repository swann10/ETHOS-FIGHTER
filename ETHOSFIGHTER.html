<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ETHOS FIGHTER</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Press Start 2P', cursive;
        }
        #screen-container {
            position: relative;
            width: 1024px;
            height: 576px;
        }
        canvas {
            width: 100%;
            height: 100%;
        }
        #ui-container {
            position: absolute;
            display: flex;
            align-items: center;
            width: 100%;
            padding: 20px;
            top: 0;
            left: 0;
            z-index: 10;
        }
        #player-health-container {
            position: relative;
            width: 100%;
            display: flex;
            justify-content: flex-end;
            border-top: 4px solid white;
            border-bottom: 4px solid white;
            border-left: 4px solid white;
        }
        #player-health-bar-bg {
            background-color: red;
            height: 30px;
            width: 100%;
        }
        #player-health-bar {
            position: absolute;
            background: #818cf8;
            top: 0;
            right: 0;
            bottom: 0;
            width: 100%;
        }
        #timer {
            background-color: black;
            width: 100px;
            height: 50px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            border: 4px solid white;
        }
        #enemy-health-container {
            position: relative;
            width: 100%;
            border-top: 4px solid white;
            border-bottom: 4px solid white;
            border-right: 4px solid white;
        }
        #enemy-health-bar-bg {
            background-color: red;
            height: 30px;
        }
        #enemy-health-bar {
            position: absolute;
            background: #818cf8;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
        }
        #result-text {
            position: absolute;
            color: white;
            align-items: center;
            justify-content: center;
            text-align: center;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            display: none;
            font-size: 24px;
            line-height: 1.5;
            text-shadow: 2px 2px 4px #000;
        }
        .start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            z-index: 20;
        }
        .start-screen-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
        }
        .start-screen-content {
            position: relative;
            z-index: 21;
        }
        .logo-image {
            width: 150px;
            height: 150px;
            margin-bottom: 2rem;
        }
        .title-text {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 2rem;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
        }
        .action-button {
            margin-top: 20px;
            padding: 1rem 2.5rem;
            font-size: 1.5rem;
            color: white;
            background: #4f46e5;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0, 0.4);
            transition: all 0.3s ease;
        }
        .action-button:hover:not(:disabled) {
            background-color: #4338ca;
            transform: scale(1.05);
        }
        .action-button:disabled {
            background-color: #4b5563;
            cursor: not-allowed;
        }
        .creator-text {
            margin-top: 3rem;
            font-size: 1rem;
            color: white;
            text-shadow: 1px 1px 2px black;
            line-height: 1.5;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div id="screen-container">
        <div id="start-screen" class="start-screen">
            <div class="start-screen-overlay"></div>
            <div class="start-screen-content">
                <img src="https://i.imghippo.com/files/Ra2466jRk.png" alt="ETHOS Logo Transparent" class="logo-image">
                <h1 class="title-text">ETHOS FIGHTER</h1>
                <button id="start-button" class="action-button">
                    LOADING ASSETS...
                </button>
                <div class="creator-text">
                    Created by @0xswan10 for @Ethereum_os
                    <br>
                    Made With ❤️
                </div>
            </div>
        </div>
        <div id="game-wrapper" class="hidden">
            <div id="ui-container">
                <div id="player-health-container">
                    <div id="player-health-bar-bg"></div>
                    <div id="player-health-bar"></div>
                </div>
                <div id="timer">60</div>
                <div id="enemy-health-container">
                    <div id="enemy-health-bar-bg"></div>
                    <div id="enemy-health-bar"></div>
                </div>
            </div>
            <div id="result-text">Tie</div>
            <canvas></canvas>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.querySelector('canvas');
            const c = canvas.getContext('2d');

            canvas.width = 1024;
            canvas.height = 576;

            c.fillRect(0, 0, canvas.width, canvas.height);

            const gravity = 0.7;

            // --- Image Assets ---
            const ethosLogoSrc = "https://i.imghippo.com/files/Ra2466jRk.png";
            const backgroundSrc = "https://raw.githubusercontent.com/chriscourses/fighting-game/main/img/background.png";
            const shopSrc = "https://raw.githubusercontent.com/chriscourses/fighting-game/main/img/shop.png";
            
            const playerIdleSrc = "https://raw.githubusercontent.com/chriscourses/fighting-game/main/img/samuraiMack/Idle.png";
            const playerRunSrc = "https://raw.githubusercontent.com/chriscourses/fighting-game/main/img/samuraiMack/Run.png";
            const playerJumpSrc = "https://raw.githubusercontent.com/chriscourses/fighting-game/main/img/samuraiMack/Jump.png";
            const playerFallSrc = "https://raw.githubusercontent.com/chriscourses/fighting-game/main/img/samuraiMack/Fall.png";
            const playerAttack1Src = "https://raw.githubusercontent.com/chriscourses/fighting-game/main/img/samuraiMack/Attack1.png";
            const playerTakeHitSrc = "https://raw.githubusercontent.com/chriscourses/fighting-game/main/img/samuraiMack/Take%20Hit%20-%20white%20silhouette.png";
            const playerDeathSrc = "https://raw.githubusercontent.com/chriscourses/fighting-game/main/img/samuraiMack/Death.png";

            const kenjiIdleSrc = "https://raw.githubusercontent.com/chriscourses/fighting-game/main/img/kenji/Idle.png";
            const kenjiRunSrc = "https://raw.githubusercontent.com/chriscourses/fighting-game/main/img/kenji/Run.png";
            const kenjiJumpSrc = "https://raw.githubusercontent.com/chriscourses/fighting-game/main/img/kenji/Jump.png";
            const kenjiFallSrc = "https://raw.githubusercontent.com/chriscourses/fighting-game/main/img/kenji/Fall.png";
            const kenjiAttack1Src = "https://raw.githubusercontent.com/chriscourses/fighting-game/main/img/kenji/Attack1.png";
            const kenjiTakeHitSrc = "https://raw.githubusercontent.com/chriscourses/fighting-game/main/img/kenji/Take%20hit.png";
            const kenjiDeathSrc = "https://raw.githubusercontent.com/chriscourses/fighting-game/main/img/kenji/Death.png";

            class Sprite {
                constructor({ position, imageSrc, scale = 1, framesMax = 1, offset = { x: 0, y: 0 } }) {
                    this.position = position;
                    this.image = new Image();
                    this.image.src = imageSrc;
                    this.scale = scale;
                    this.framesMax = framesMax;
                    this.framesCurrent = 0;
                    this.framesElapsed = 0;
                    this.framesHold = 5;
                    this.offset = offset;
                }

                draw() {
                    if (this.image.complete && this.image.naturalHeight !== 0) {
                        c.drawImage(
                            this.image,
                            this.framesCurrent * (this.image.width / this.framesMax), 0,
                            this.image.width / this.framesMax, this.image.height,
                            this.position.x - this.offset.x, this.position.y - this.offset.y,
                            (this.image.width / this.framesMax) * this.scale, this.image.height * this.scale
                        );
                    }
                }

                animateFrames() {
                    this.framesElapsed++;
                    if (this.framesElapsed % this.framesHold === 0) {
                        if (this.framesCurrent < this.framesMax - 1) this.framesCurrent++;
                        else this.framesCurrent = 0;
                    }
                }

                update() {
                    this.draw();
                    this.animateFrames();
                }
            }

            class Fighter extends Sprite {
                constructor({
                    position, velocity, color = 'red', imageSrc, scale = 1, framesMax = 1,
                    offset = { x: 0, y: 0 }, sprites,
                    attackBox = { offset: {}, width: undefined, height: undefined }
                }) {
                    super({ position, imageSrc, scale, framesMax, offset });
                    this.velocity = velocity;
                    this.width = 50;
                    this.height = 150;
                    this.lastKey;
                    this.attackBox = {
                        position: { x: this.position.x, y: this.position.y },
                        offset: attackBox.offset,
                        width: attackBox.width,
                        height: attackBox.height
                    };
                    this.color = color;
                    this.isAttacking;
                    this.health = 100;
                    this.framesCurrent = 0;
                    this.framesElapsed = 0;
                    this.framesHold = 5;
                    this.sprites = sprites;
                    this.dead = false;

                    for (const sprite in this.sprites) {
                        sprites[sprite].image = new Image();
                        sprites[sprite].image.src = sprites[sprite].imageSrc;
                    }
                }

                update() {
                    this.draw();
                    if (!this.dead) this.animateFrames();

                    this.attackBox.position.x = this.position.x + this.attackBox.offset.x;
                    this.attackBox.position.y = this.position.y + this.attackBox.offset.y;

                    this.position.x += this.velocity.x;
                    this.position.y += this.velocity.y;

                    if (this.position.y + this.height + this.velocity.y >= canvas.height - 96) {
                        this.velocity.y = 0;
                        this.position.y = 330;
                    } else {
                        this.velocity.y += gravity;
                    }
                }

                attack() {
                    this.switchSprite('attack1');
                    this.isAttacking = true;
                }

                takeHit() {
                    this.health -= 20;
                    if (this.health <= 0) {
                        this.switchSprite('death');
                    } else {
                        this.switchSprite('takeHit');
                    }
                }

                switchSprite(sprite) {
                    if (this.image === this.sprites.death.image) {
                        if (this.framesCurrent === this.sprites.death.framesMax - 1) this.dead = true;
                        return;
                    }
                    if (this.image === this.sprites.attack1.image && this.framesCurrent < this.sprites.attack1.framesMax - 1) return;
                    if (this.image === this.sprites.takeHit.image && this.framesCurrent < this.sprites.takeHit.framesMax - 1) return;

                    switch (sprite) {
                        case 'idle':
                            if (this.image !== this.sprites.idle.image) {
                                this.image = this.sprites.idle.image;
                                this.framesMax = this.sprites.idle.framesMax;
                                this.framesCurrent = 0;
                            }
                            break;
                        case 'run':
                            if (this.image !== this.sprites.run.image) {
                                this.image = this.sprites.run.image;
                                this.framesMax = this.sprites.run.framesMax;
                                this.framesCurrent = 0;
                            }
                            break;
                        case 'jump':
                            if (this.image !== this.sprites.jump.image) {
                                this.image = this.sprites.jump.image;
                                this.framesMax = this.sprites.jump.framesMax;
                                this.framesCurrent = 0;
                            }
                            break;
                        case 'fall':
                            if (this.image !== this.sprites.fall.image) {
                                this.image = this.sprites.fall.image;
                                this.framesMax = this.sprites.fall.framesMax;
                                this.framesCurrent = 0;
                            }
                            break;
                        case 'attack1':
                            if (this.image !== this.sprites.attack1.image) {
                                this.image = this.sprites.attack1.image;
                                this.framesMax = this.sprites.attack1.framesMax;
                                this.framesCurrent = 0;
                            }
                            break;
                        case 'takeHit':
                            if (this.image !== this.sprites.takeHit.image) {
                                this.image = this.sprites.takeHit.image;
                                this.framesMax = this.sprites.takeHit.framesMax;
                                this.framesCurrent = 0;
                            }
                            break;
                        case 'death':
                            if (this.image !== this.sprites.death.image) {
                                this.image = this.sprites.death.image;
                                this.framesMax = this.sprites.death.framesMax;
                                this.framesCurrent = 0;
                            }
                            break;
                    }
                }
            }
            
            const background = new Sprite({ position: { x: 0, y: 0 }, imageSrc: backgroundSrc });
            const shop = new Sprite({ position: { x: 600, y: 128 }, imageSrc: shopSrc, scale: 2.75, framesMax: 6 });
            
            const backgroundLogos = [];
            for(let i = 0; i < 6; i++) {
                backgroundLogos.push(new Sprite({
                    position: { x: Math.random() * canvas.width, y: 100 + Math.random() * 150 },
                    imageSrc: ethosLogoSrc,
                    scale: 0.1 + Math.random() * 0.15
                }));
            }

            const player = new Fighter({
                position: { x: 200, y: 0 },
                velocity: { x: 0, y: 0 },
                imageSrc: playerIdleSrc,
                scale: 2.5,
                offset: { x: 215, y: 157 },
                sprites: {
                    idle: { imageSrc: playerIdleSrc, framesMax: 8 },
                    run: { imageSrc: playerRunSrc, framesMax: 8 },
                    jump: { imageSrc: playerJumpSrc, framesMax: 2 },
                    fall: { imageSrc: playerFallSrc, framesMax: 2 },
                    attack1: { imageSrc: playerAttack1Src, framesMax: 6 },
                    takeHit: { imageSrc: playerTakeHitSrc, framesMax: 4 },
                    death: { imageSrc: playerDeathSrc, framesMax: 6 }
                },
                attackBox: {
                    offset: { x: 100, y: 50 },
                    width: 160,
                    height: 50
                }
            });

            const enemy = new Fighter({
                position: { x: 700, y: 100 },
                velocity: { x: 0, y: 0 },
                color: 'blue',
                offset: { x: 215, y: 167 },
                imageSrc: kenjiIdleSrc,
                scale: 2.5,
                framesMax: 4,
                sprites: {
                    idle: { imageSrc: kenjiIdleSrc, framesMax: 4 },
                    run: { imageSrc: kenjiRunSrc, framesMax: 8 },
                    jump: { imageSrc: kenjiJumpSrc, framesMax: 2 },
                    fall: { imageSrc: kenjiFallSrc, framesMax: 2 },
                    attack1: { imageSrc: kenjiAttack1Src, framesMax: 4 },
                    takeHit: { imageSrc: kenjiTakeHitSrc, framesMax: 3 },
                    death: { imageSrc: kenjiDeathSrc, framesMax: 7 }
                },
                attackBox: {
                    offset: { x: -170, y: 50 },
                    width: 170,
                    height: 50
                }
            });

            const keys = {
                a: { pressed: false },
                d: { pressed: false }
            };

            function rectangularCollision({ rectangle1, rectangle2 }) {
                return (
                    rectangle1.attackBox.position.x + rectangle1.attackBox.width >= rectangle2.position.x &&
                    rectangle1.attackBox.position.x <= rectangle2.position.x + rectangle2.width &&
                    rectangle1.attackBox.position.y + rectangle1.attackBox.height >= rectangle2.position.y &&
                    rectangle1.attackBox.position.y <= rectangle2.position.y + rectangle2.height
                );
            }

            function determineWinner({ player, enemy, timerId }) {
                clearTimeout(timerId);
                const resultTextEl = document.querySelector('#result-text');
                resultTextEl.style.display = 'flex';
                if (player.health === enemy.health) {
                    resultTextEl.innerHTML = 'Tie';
                } else if (player.health > enemy.health) {
                    const winCode = 'XZhkLYlHUf'; // Kode tetap
                    resultTextEl.innerHTML = `You Win!<br>Your Code: ${winCode}`;
                } else if (player.health < enemy.health) {
                    resultTextEl.innerHTML = 'AI Wins!';
                }
            }

            let timer = 60;
            let timerId;
            function decreaseTimer() {
                if (timer > 0) {
                    timerId = setTimeout(decreaseTimer, 1000);
                    timer--;
                    document.querySelector('#timer').innerHTML = timer;
                }
                if (timer === 0) {
                    determineWinner({ player, enemy, timerId });
                }
            }

            function animate() {
                window.requestAnimationFrame(animate);
                c.fillStyle = 'black';
                c.fillRect(0, 0, canvas.width, canvas.height);
                background.update();
                backgroundLogos.forEach(logo => logo.update());
                shop.update();
                c.fillStyle = 'rgba(255, 255, 255, 0.15)';
                c.fillRect(0, 0, canvas.width, canvas.height);
                player.update();
                enemy.update();

                player.velocity.x = 0;
                enemy.velocity.x = 0;

                // Player movement
                if (keys.a.pressed && player.lastKey === 'a') {
                    player.velocity.x = -5;
                    player.switchSprite('run');
                } else if (keys.d.pressed && player.lastKey === 'd') {
                    player.velocity.x = 5;
                    player.switchSprite('run');
                } else {
                    player.switchSprite('idle');
                }
                if (player.velocity.y < 0) {
                    player.switchSprite('jump');
                } else if (player.velocity.y > 0) {
                    player.switchSprite('fall');
                }

                // Enemy AI
                if (!enemy.dead) {
                    const distance = player.position.x - enemy.position.x;
                    if (Math.abs(distance) > enemy.attackBox.width) {
                        enemy.velocity.x = Math.sign(distance) * 3;
                        enemy.switchSprite('run');
                    } else {
                         enemy.switchSprite('idle');
                         if (Math.random() < 0.02 && !enemy.isAttacking) {
                             enemy.attack();
                         }
                    }
                    if (enemy.velocity.y < 0) {
                        enemy.switchSprite('jump');
                    } else if (enemy.velocity.y > 0) {
                        enemy.switchSprite('fall');
                    }
                } else {
                    enemy.switchSprite('death');
                }


                // Collision detection
                if (rectangularCollision({ rectangle1: player, rectangle2: enemy }) && player.isAttacking && player.framesCurrent === 4) {
                    enemy.takeHit();
                    player.isAttacking = false;
                    document.querySelector('#enemy-health-bar').style.width = enemy.health + '%';
                }
                if (player.isAttacking && player.framesCurrent === 4) {
                    player.isAttacking = false;
                }
                if (rectangularCollision({ rectangle1: enemy, rectangle2: player }) && enemy.isAttacking && enemy.framesCurrent === 2) {
                    player.takeHit();
                    enemy.isAttacking = false;
                    document.querySelector('#player-health-bar').style.width = player.health + '%';
                }
                if (enemy.isAttacking && enemy.framesCurrent === 2) {
                    enemy.isAttacking = false;
                }

                if (enemy.health <= 0 || player.health <= 0) {
                    determineWinner({ player, enemy, timerId });
                }
            }

            function startGame() {
                document.querySelector('#start-screen').classList.add('hidden');
                document.querySelector('#game-wrapper').classList.remove('hidden');
                
                document.querySelector('#result-text').style.display = 'none';
                player.health = 100;
                enemy.health = 100;
                player.dead = false;
                enemy.dead = false;
                player.switchSprite('idle');
                enemy.switchSprite('idle');
                document.querySelector('#player-health-bar').style.width = '100%';
                document.querySelector('#enemy-health-bar').style.width = '100%';
                player.position = { x: 200, y: 0 };
                enemy.position = { x: 700, y: 100 };
                timer = 60;
                clearTimeout(timerId);
                decreaseTimer();
                animate();
            }

            window.addEventListener('keydown', (event) => {
                if (!player.dead) {
                    switch (event.key) {
                        case 'd': keys.d.pressed = true; player.lastKey = 'd'; break;
                        case 'a': keys.a.pressed = true; player.lastKey = 'a'; break;
                        case 'w': if (player.position.y > 329) player.velocity.y = -20; break;
                        case ' ': player.attack(); break;
                    }
                }
            });

            window.addEventListener('keyup', (event) => {
                switch (event.key) {
                    case 'd': keys.d.pressed = false; break;
                    case 'a': keys.a.pressed = false; break;
                }
            });
            
            // Preload assets before starting the game
            const assetSources = [
                ethosLogoSrc, backgroundSrc, shopSrc,
                playerIdleSrc, playerRunSrc, playerJumpSrc, playerFallSrc, playerAttack1Src, playerTakeHitSrc, playerDeathSrc,
                kenjiIdleSrc, kenjiRunSrc, kenjiJumpSrc, kenjiFallSrc, kenjiAttack1Src, kenjiTakeHitSrc, kenjiDeathSrc
            ];
            let assetsLoaded = 0;
            
            function assetLoaded() {
                assetsLoaded++;
                if (assetsLoaded === assetSources.length) {
                    const startButton = document.querySelector('#start-button');
                    document.getElementById('start-screen').style.backgroundImage = `url(${backgroundSrc})`;
                    startButton.disabled = false;
                    startButton.textContent = "START GAME";
                }
            }

            assetSources.forEach(src => {
                const img = new Image();
                img.crossOrigin = "anonymous";
                img.src = src;
                img.onload = assetLoaded;
                img.onerror = () => {
                    console.error(`Failed to load asset: ${src}`);
                    assetLoaded();
                };
            });

            const startButton = document.querySelector('#start-button');
            startButton.disabled = true;
            startButton.addEventListener('click', startGame);
        });
    </script>
</body>
</html>
